<!DOCTYPE html>
<html>
<head>
  <title>Login Sistem</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container d-flex justify-content-center align-items-center" style="height: 100vh;">
    <div class="card shadow p-4" style="max-width: 400px; width: 100%;">
      <h3 class="text-center mb-4">Login Toko</h3>
      
      <div class="mb-3">
        <label>Username</label>
        <input type="text" id="username" class="form-control" placeholder="Contoh: Admin">
      </div>
      
      <div class="mb-3">
        <label>PIN</label>
        <input type="password" id="pin" class="form-control" placeholder="******">
      </div>
      
      <button onclick="login()" id="btnLogin" class="btn btn-primary w-100">MASUK</button>
      <p id="msg" class="text-danger text-center mt-2"></p>
    </div>
  </div>

  <script src="assets/js/api.js"></script>
  <script>
    async function login() {
      const user = document.getElementById('username').value;
      const pass = document.getElementById('pin').value;
      const btn = document.getElementById('btnLogin');

      btn.disabled = true; 
      btn.innerText = "Memeriksa...";

      // Panggil fungsi dari api.js
      const hasil = await requestKeGoogle('login', { username: user, pin: pass });
      
      btn.disabled = false;
      btn.innerText = "MASUK";

      if (hasil && hasil.status === "SUKSES") {
        // Simpan sesi di LocalStorage browser
        localStorage.setItem("user_role", hasil.role);
        localStorage.setItem("user_lokasi", hasil.lokasi);

        // --- UPDATE LOGIKA REDIRECT DI SINI ---
        
        // 1. Cek Apakah Dia BOS/OWNER/ADMIN?
        if (hasil.role === "OWNER" || hasil.role === "ADMIN") {
           window.location.href = "pages/admin.html";
        } 
        // 2. Cek Apakah Dia Orang Gudang?
        else if (hasil.lokasi === "Gudang") {
          window.location.href = "pages/gudang.html";
        } 
        // 3. Sisanya (Kasir Toko 1 / Toko 2)
        else {
          window.location.href = "pages/toko.html";
        }
      } else {
        document.getElementById('msg').innerText = "Login Gagal. Cek Username/PIN.";
      }
    }
  </script>
</body>
</html>